<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>甲骨文-人</title>
<script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>

<a-scene
  mindar-image="imageTargetSrc: /lobby/jiagu-ren.mind; autoStart: true; uiScanning: true;"
  color-space="sRGB"
  renderer="colorManagement: true; physicallyCorrectLights: true"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
>
  <a-assets>
    <video id="introVid" src="/jiagu-video/jiagu-ren.mp4" preload="auto" loop muted playsinline webkit-playsinline></video>
  </a-assets>

  <a-light type="ambient" intensity="1.5"></a-light>
  <a-camera look-controls="enabled: false"></a-camera>

  <a-entity mindar-image-target="targetIndex: 0">
    <a-video
      id="videoEntity"
      src="#introVid"
      width="1.2"
      height="0.7"
      position="0 0 0"
      loop
      muted
      playsinline
      webkit-playsinline
      material="shader: flat; src: #introVid;"
    ></a-video>
  </a-entity>
</a-scene>

<script>
const video = document.querySelector('#introVid');
const targetEntity = document.querySelector('a-entity[mindar-image-target]');

// 確保影片可以播放
video.load();

// 手機端第一次觸碰後允許播放
const enableVideoPlay = () => {
  video.play().catch(err => console.log('需使用者互動才能播放影片', err));
};
document.body.addEventListener('click', enableVideoPlay, { once: true });
document.body.addEventListener('touchstart', enableVideoPlay, { once: true });

// targetFound 時播放影片
targetEntity.addEventListener('targetFound', () => {
  if(video.readyState >= 2){ // HAVE_CURRENT_DATA
    video.play();
  } else {
    video.addEventListener('canplay', () => video.play(), { once: true });
  }
});

// targetLost 時暫停影片
targetEntity.addEventListener('targetLost', () => {
  video.pause();
  video.currentTime = 0;
});
</script>

<style>
#backHomeBtn {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
}
</style>

<a href="https://sites.google.com/view/hanzilab">
  <img id="backHomeBtn" src="/lobby/LOGO去背.png" style="width: 250px; height:auto">
</a>

</body>
</html>
